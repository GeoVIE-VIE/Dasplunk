<form version="1.1" theme="dark">
  <label>Network Syslog Intelligence Center</label>
  <description>Comprehensive monitoring for Cisco and Brocade network infrastructure | Real-time syslog analysis and alerting</description>

  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_range" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="vendor_filter" searchWhenChanged="true">
      <label>Vendor</label>
      <choice value="">All Vendors</choice>
      <choice value="vendor_detected=&quot;cisco&quot;">Cisco</choice>
      <choice value="vendor_detected=&quot;brocade&quot;">Brocade</choice>
      <default></default>
    </input>
    <input type="dropdown" token="severity_filter" searchWhenChanged="true">
      <label>Severity</label>
      <choice value="">All Severities</choice>
      <choice value="severity_num=0">Emergency (0)</choice>
      <choice value="severity_num=1">Alert (1)</choice>
      <choice value="severity_num=2">Critical (2)</choice>
      <choice value="severity_num=3">Error (3)</choice>
      <choice value="severity_num=4">Warning (4)</choice>
      <choice value="severity_num=5">Notice (5)</choice>
      <choice value="severity_num=6">Informational (6)</choice>
      <choice value="severity_num=7">Debug (7)</choice>
      <default></default>
    </input>
    <input type="text" token="device_filter" searchWhenChanged="true">
      <label>Device Filter</label>
      <default>*</default>
      <prefix>host=</prefix>
    </input>

    <!-- AREA FILTER: Replace hostname patterns below with your actual device naming conventions
         Example: Replace "NYC*" for area pattern and "*NYC-MAN-*", "*NYC-BRK-*" etc for site patterns
         Format: (host="AREA_PATTERN" OR host="SITE1_PATTERN" OR host="SITE2_PATTERN" ... OR host="SITE10_PATTERN") -->
    <input type="dropdown" token="area_filter" searchWhenChanged="true">
      <label>Area</label>
      <choice value="">All Areas</choice>
      <!-- AREA 1: Replace patterns below -->
      <choice value="(host=&quot;AREA1*&quot; OR host=&quot;*SITE1-1*&quot; OR host=&quot;*SITE1-2*&quot; OR host=&quot;*SITE1-3*&quot; OR host=&quot;*SITE1-4*&quot; OR host=&quot;*SITE1-5*&quot; OR host=&quot;*SITE1-6*&quot; OR host=&quot;*SITE1-7*&quot; OR host=&quot;*SITE1-8*&quot; OR host=&quot;*SITE1-9*&quot; OR host=&quot;*SITE1-10*&quot;)">Area 1</choice>
      <!-- AREA 2: Replace patterns below -->
      <choice value="(host=&quot;AREA2*&quot; OR host=&quot;*SITE2-1*&quot; OR host=&quot;*SITE2-2*&quot; OR host=&quot;*SITE2-3*&quot; OR host=&quot;*SITE2-4*&quot; OR host=&quot;*SITE2-5*&quot; OR host=&quot;*SITE2-6*&quot; OR host=&quot;*SITE2-7*&quot; OR host=&quot;*SITE2-8*&quot; OR host=&quot;*SITE2-9*&quot; OR host=&quot;*SITE2-10*&quot;)">Area 2</choice>
      <!-- AREA 3: Replace patterns below -->
      <choice value="(host=&quot;AREA3*&quot; OR host=&quot;*SITE3-1*&quot; OR host=&quot;*SITE3-2*&quot; OR host=&quot;*SITE3-3*&quot; OR host=&quot;*SITE3-4*&quot; OR host=&quot;*SITE3-5*&quot; OR host=&quot;*SITE3-6*&quot; OR host=&quot;*SITE3-7*&quot; OR host=&quot;*SITE3-8*&quot; OR host=&quot;*SITE3-9*&quot; OR host=&quot;*SITE3-10*&quot;)">Area 3</choice>
      <!-- AREA 4: Replace patterns below -->
      <choice value="(host=&quot;AREA4*&quot; OR host=&quot;*SITE4-1*&quot; OR host=&quot;*SITE4-2*&quot; OR host=&quot;*SITE4-3*&quot; OR host=&quot;*SITE4-4*&quot; OR host=&quot;*SITE4-5*&quot; OR host=&quot;*SITE4-6*&quot; OR host=&quot;*SITE4-7*&quot; OR host=&quot;*SITE4-8*&quot; OR host=&quot;*SITE4-9*&quot; OR host=&quot;*SITE4-10*&quot;)">Area 4</choice>
      <!-- AREA 5: Replace patterns below -->
      <choice value="(host=&quot;AREA5*&quot; OR host=&quot;*SITE5-1*&quot; OR host=&quot;*SITE5-2*&quot; OR host=&quot;*SITE5-3*&quot; OR host=&quot;*SITE5-4*&quot; OR host=&quot;*SITE5-5*&quot; OR host=&quot;*SITE5-6*&quot; OR host=&quot;*SITE5-7*&quot; OR host=&quot;*SITE5-8*&quot; OR host=&quot;*SITE5-9*&quot; OR host=&quot;*SITE5-10*&quot;)">Area 5</choice>
      <!-- AREA 6: Replace patterns below -->
      <choice value="(host=&quot;AREA6*&quot; OR host=&quot;*SITE6-1*&quot; OR host=&quot;*SITE6-2*&quot; OR host=&quot;*SITE6-3*&quot; OR host=&quot;*SITE6-4*&quot; OR host=&quot;*SITE6-5*&quot; OR host=&quot;*SITE6-6*&quot; OR host=&quot;*SITE6-7*&quot; OR host=&quot;*SITE6-8*&quot; OR host=&quot;*SITE6-9*&quot; OR host=&quot;*SITE6-10*&quot;)">Area 6</choice>
      <!-- AREA 7: Replace patterns below -->
      <choice value="(host=&quot;AREA7*&quot; OR host=&quot;*SITE7-1*&quot; OR host=&quot;*SITE7-2*&quot; OR host=&quot;*SITE7-3*&quot; OR host=&quot;*SITE7-4*&quot; OR host=&quot;*SITE7-5*&quot; OR host=&quot;*SITE7-6*&quot; OR host=&quot;*SITE7-7*&quot; OR host=&quot;*SITE7-8*&quot; OR host=&quot;*SITE7-9*&quot; OR host=&quot;*SITE7-10*&quot;)">Area 7</choice>
      <!-- AREA 8: Replace patterns below -->
      <choice value="(host=&quot;AREA8*&quot; OR host=&quot;*SITE8-1*&quot; OR host=&quot;*SITE8-2*&quot; OR host=&quot;*SITE8-3*&quot; OR host=&quot;*SITE8-4*&quot; OR host=&quot;*SITE8-5*&quot; OR host=&quot;*SITE8-6*&quot; OR host=&quot;*SITE8-7*&quot; OR host=&quot;*SITE8-8*&quot; OR host=&quot;*SITE8-9*&quot; OR host=&quot;*SITE8-10*&quot;)">Area 8</choice>
      <!-- AREA 9: Replace patterns below -->
      <choice value="(host=&quot;AREA9*&quot; OR host=&quot;*SITE9-1*&quot; OR host=&quot;*SITE9-2*&quot; OR host=&quot;*SITE9-3*&quot; OR host=&quot;*SITE9-4*&quot; OR host=&quot;*SITE9-5*&quot; OR host=&quot;*SITE9-6*&quot; OR host=&quot;*SITE9-7*&quot; OR host=&quot;*SITE9-8*&quot; OR host=&quot;*SITE9-9*&quot; OR host=&quot;*SITE9-10*&quot;)">Area 9</choice>
      <!-- AREA 10: Replace patterns below -->
      <choice value="(host=&quot;AREA10*&quot; OR host=&quot;*SITE10-1*&quot; OR host=&quot;*SITE10-2*&quot; OR host=&quot;*SITE10-3*&quot; OR host=&quot;*SITE10-4*&quot; OR host=&quot;*SITE10-5*&quot; OR host=&quot;*SITE10-6*&quot; OR host=&quot;*SITE10-7*&quot; OR host=&quot;*SITE10-8*&quot; OR host=&quot;*SITE10-9*&quot; OR host=&quot;*SITE10-10*&quot;)">Area 10</choice>
      <default></default>
    </input>
    <!-- SITE FILTER: Replace with your actual site hostname patterns
         Example: host="*NYC-MAN-*" for NYC Manhattan site -->
    <input type="dropdown" token="site_filter" searchWhenChanged="true">
      <label>Site</label>
      <choice value="">All Sites</choice>
      <choice value="host=&quot;*SITE1-1*&quot;">Site 1.1</choice>
      <choice value="host=&quot;*SITE1-2*&quot;">Site 1.2</choice>
      <choice value="host=&quot;*SITE1-3*&quot;">Site 1.3</choice>
      <choice value="host=&quot;*SITE1-4*&quot;">Site 1.4</choice>
      <choice value="host=&quot;*SITE1-5*&quot;">Site 1.5</choice>
      <choice value="host=&quot;*SITE1-6*&quot;">Site 1.6</choice>
      <choice value="host=&quot;*SITE1-7*&quot;">Site 1.7</choice>
      <choice value="host=&quot;*SITE1-8*&quot;">Site 1.8</choice>
      <choice value="host=&quot;*SITE1-9*&quot;">Site 1.9</choice>
      <choice value="host=&quot;*SITE1-10*&quot;">Site 1.10</choice>
      <choice value="host=&quot;*SITE2-1*&quot;">Site 2.1</choice>
      <choice value="host=&quot;*SITE2-2*&quot;">Site 2.2</choice>
      <choice value="host=&quot;*SITE2-3*&quot;">Site 2.3</choice>
      <choice value="host=&quot;*SITE2-4*&quot;">Site 2.4</choice>
      <choice value="host=&quot;*SITE2-5*&quot;">Site 2.5</choice>
      <choice value="host=&quot;*SITE2-6*&quot;">Site 2.6</choice>
      <choice value="host=&quot;*SITE2-7*&quot;">Site 2.7</choice>
      <choice value="host=&quot;*SITE2-8*&quot;">Site 2.8</choice>
      <choice value="host=&quot;*SITE2-9*&quot;">Site 2.9</choice>
      <choice value="host=&quot;*SITE2-10*&quot;">Site 2.10</choice>
      <choice value="host=&quot;*SITE3-1*&quot;">Site 3.1</choice>
      <choice value="host=&quot;*SITE3-2*&quot;">Site 3.2</choice>
      <choice value="host=&quot;*SITE3-3*&quot;">Site 3.3</choice>
      <choice value="host=&quot;*SITE3-4*&quot;">Site 3.4</choice>
      <choice value="host=&quot;*SITE3-5*&quot;">Site 3.5</choice>
      <choice value="host=&quot;*SITE3-6*&quot;">Site 3.6</choice>
      <choice value="host=&quot;*SITE3-7*&quot;">Site 3.7</choice>
      <choice value="host=&quot;*SITE3-8*&quot;">Site 3.8</choice>
      <choice value="host=&quot;*SITE3-9*&quot;">Site 3.9</choice>
      <choice value="host=&quot;*SITE3-10*&quot;">Site 3.10</choice>
      <choice value="host=&quot;*SITE4-1*&quot;">Site 4.1</choice>
      <choice value="host=&quot;*SITE4-2*&quot;">Site 4.2</choice>
      <choice value="host=&quot;*SITE4-3*&quot;">Site 4.3</choice>
      <choice value="host=&quot;*SITE4-4*&quot;">Site 4.4</choice>
      <choice value="host=&quot;*SITE4-5*&quot;">Site 4.5</choice>
      <choice value="host=&quot;*SITE4-6*&quot;">Site 4.6</choice>
      <choice value="host=&quot;*SITE4-7*&quot;">Site 4.7</choice>
      <choice value="host=&quot;*SITE4-8*&quot;">Site 4.8</choice>
      <choice value="host=&quot;*SITE4-9*&quot;">Site 4.9</choice>
      <choice value="host=&quot;*SITE4-10*&quot;">Site 4.10</choice>
      <choice value="host=&quot;*SITE5-1*&quot;">Site 5.1</choice>
      <choice value="host=&quot;*SITE5-2*&quot;">Site 5.2</choice>
      <choice value="host=&quot;*SITE5-3*&quot;">Site 5.3</choice>
      <choice value="host=&quot;*SITE5-4*&quot;">Site 5.4</choice>
      <choice value="host=&quot;*SITE5-5*&quot;">Site 5.5</choice>
      <choice value="host=&quot;*SITE5-6*&quot;">Site 5.6</choice>
      <choice value="host=&quot;*SITE5-7*&quot;">Site 5.7</choice>
      <choice value="host=&quot;*SITE5-8*&quot;">Site 5.8</choice>
      <choice value="host=&quot;*SITE5-9*&quot;">Site 5.9</choice>
      <choice value="host=&quot;*SITE5-10*&quot;">Site 5.10</choice>
      <choice value="host=&quot;*SITE6-1*&quot;">Site 6.1</choice>
      <choice value="host=&quot;*SITE6-2*&quot;">Site 6.2</choice>
      <choice value="host=&quot;*SITE6-3*&quot;">Site 6.3</choice>
      <choice value="host=&quot;*SITE6-4*&quot;">Site 6.4</choice>
      <choice value="host=&quot;*SITE6-5*&quot;">Site 6.5</choice>
      <choice value="host=&quot;*SITE6-6*&quot;">Site 6.6</choice>
      <choice value="host=&quot;*SITE6-7*&quot;">Site 6.7</choice>
      <choice value="host=&quot;*SITE6-8*&quot;">Site 6.8</choice>
      <choice value="host=&quot;*SITE6-9*&quot;">Site 6.9</choice>
      <choice value="host=&quot;*SITE6-10*&quot;">Site 6.10</choice>
      <choice value="host=&quot;*SITE7-1*&quot;">Site 7.1</choice>
      <choice value="host=&quot;*SITE7-2*&quot;">Site 7.2</choice>
      <choice value="host=&quot;*SITE7-3*&quot;">Site 7.3</choice>
      <choice value="host=&quot;*SITE7-4*&quot;">Site 7.4</choice>
      <choice value="host=&quot;*SITE7-5*&quot;">Site 7.5</choice>
      <choice value="host=&quot;*SITE7-6*&quot;">Site 7.6</choice>
      <choice value="host=&quot;*SITE7-7*&quot;">Site 7.7</choice>
      <choice value="host=&quot;*SITE7-8*&quot;">Site 7.8</choice>
      <choice value="host=&quot;*SITE7-9*&quot;">Site 7.9</choice>
      <choice value="host=&quot;*SITE7-10*&quot;">Site 7.10</choice>
      <choice value="host=&quot;*SITE8-1*&quot;">Site 8.1</choice>
      <choice value="host=&quot;*SITE8-2*&quot;">Site 8.2</choice>
      <choice value="host=&quot;*SITE8-3*&quot;">Site 8.3</choice>
      <choice value="host=&quot;*SITE8-4*&quot;">Site 8.4</choice>
      <choice value="host=&quot;*SITE8-5*&quot;">Site 8.5</choice>
      <choice value="host=&quot;*SITE8-6*&quot;">Site 8.6</choice>
      <choice value="host=&quot;*SITE8-7*&quot;">Site 8.7</choice>
      <choice value="host=&quot;*SITE8-8*&quot;">Site 8.8</choice>
      <choice value="host=&quot;*SITE8-9*&quot;">Site 8.9</choice>
      <choice value="host=&quot;*SITE8-10*&quot;">Site 8.10</choice>
      <choice value="host=&quot;*SITE9-1*&quot;">Site 9.1</choice>
      <choice value="host=&quot;*SITE9-2*&quot;">Site 9.2</choice>
      <choice value="host=&quot;*SITE9-3*&quot;">Site 9.3</choice>
      <choice value="host=&quot;*SITE9-4*&quot;">Site 9.4</choice>
      <choice value="host=&quot;*SITE9-5*&quot;">Site 9.5</choice>
      <choice value="host=&quot;*SITE9-6*&quot;">Site 9.6</choice>
      <choice value="host=&quot;*SITE9-7*&quot;">Site 9.7</choice>
      <choice value="host=&quot;*SITE9-8*&quot;">Site 9.8</choice>
      <choice value="host=&quot;*SITE9-9*&quot;">Site 9.9</choice>
      <choice value="host=&quot;*SITE9-10*&quot;">Site 9.10</choice>
      <choice value="host=&quot;*SITE10-1*&quot;">Site 10.1</choice>
      <choice value="host=&quot;*SITE10-2*&quot;">Site 10.2</choice>
      <choice value="host=&quot;*SITE10-3*&quot;">Site 10.3</choice>
      <choice value="host=&quot;*SITE10-4*&quot;">Site 10.4</choice>
      <choice value="host=&quot;*SITE10-5*&quot;">Site 10.5</choice>
      <choice value="host=&quot;*SITE10-6*&quot;">Site 10.6</choice>
      <choice value="host=&quot;*SITE10-7*&quot;">Site 10.7</choice>
      <choice value="host=&quot;*SITE10-8*&quot;">Site 10.8</choice>
      <choice value="host=&quot;*SITE10-9*&quot;">Site 10.9</choice>
      <choice value="host=&quot;*SITE10-10*&quot;">Site 10.10</choice>
      <default></default>
    </input>
    <input type="dropdown" token="facility_filter" searchWhenChanged="true">
      <label>Facility</label>
      <choice value="">All Facilities</choice>
      <choice value="facility_num=0">Kernel (0)</choice>
      <choice value="facility_num=1">User (1)</choice>
      <choice value="facility_num=4">Auth (4)</choice>
      <choice value="facility_num=10">Security (10)</choice>
      <choice value="facility_num=16">Local0 (16)</choice>
      <choice value="facility_num=17">Local1 (17)</choice>
      <choice value="facility_num=18">Local2 (18)</choice>
      <choice value="facility_num=19">Local3 (19)</choice>
      <choice value="facility_num=20">Local4 (20)</choice>
      <choice value="facility_num=21">Local5 (21)</choice>
      <choice value="facility_num=22">Local6 (22)</choice>
      <choice value="facility_num=23">Local7 (23)</choice>
      <default></default>
    </input>
  </fieldset>

  <!-- BASE SEARCH: Detects vendor and parses syslog format accordingly -->
  <!-- Cisco format: %FACILITY-SEVERITY-MNEMONIC: message -->
  <!-- Brocade format: timestamp:LEVEL_CODE:FACILITY: message (A=alert,C=critical,D=debug,M=emergency,E=error,I=info,N=notice,W=warning) -->
  <search id="base_syslog">
    <query>index=network_syslog $device_filter$
| rex field=_raw "^&lt;(?&lt;pri&gt;\d+)&gt;"
| eval pri=tonumber(pri)
| eval facility_num=if(isnum(pri), floor(pri/8), null())
| eval syslog_severity=if(isnum(pri), pri%8, null())
| rex field=_raw "hostname:\s+(?&lt;extracted_hostname_labeled&gt;[A-Za-z][A-Za-z0-9._-]+)"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})\s+(?:\d{1,3}\.){3}\d{1,3}\s+\d+:\s*(?&lt;extracted_hostname_cisco&gt;[A-Za-z][A-Za-z0-9._-]+):"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})\s+(?!(?:\d{1,3}\.){3}\d{1,3}\s)(?&lt;extracted_hostname_standard&gt;[A-Za-z][A-Za-z0-9._-]+)"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})\s+(?:\d{1,3}\.){3}\d{1,3}\s+(?&lt;extracted_hostname_after_ip&gt;[A-Za-z][A-Za-z0-9._-]+)(?=:)"
| eval is_ip_address=if(match(host, "^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$"), 1, 0)
| eval validated_host=if(is_ip_address=0 AND isnotnull(host) AND match(host, "^[A-Za-z]"), host, null())
| eval hostname_refined=coalesce(extracted_hostname_labeled, extracted_hostname_cisco, extracted_hostname_after_ip, extracted_hostname_standard, validated_host)
| eval host=if(isnotnull(hostname_refined), hostname_refined, host)
| rex field=_raw "%(?&lt;cisco_facility&gt;[A-Z][A-Z0-9_]*)-(?&lt;cisco_severity&gt;[0-7])-(?&lt;cisco_mnemonic&gt;[A-Z0-9_]+)"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})[:,\s]+(?&lt;brocade_level_letter&gt;[ACDMEINW])[:\s]+(?&lt;brocade_facility&gt;[A-Za-z0-9_\-]+)"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})\s+(?&lt;brocade_host_token&gt;[^\s:]+)\s+(?&lt;brocade_facility_simple&gt;[A-Za-z0-9_.\-]+)"
| rex field=_raw "\[(?&lt;brocade_module&gt;[A-Z0-9]{3})/(?&lt;brocade_severity_num&gt;[0-7])/(?&lt;brocade_code&gt;[A-Z0-9_-]+)\]"
| rex field=_raw "%(?&lt;brocade_facility_alt&gt;[A-Z0-9_]+)-(?&lt;brocade_severity_alt&gt;[0-7])-(?&lt;brocade_code_alt&gt;[A-Z0-9_-]+)"
| eval brocade_severity_raw=coalesce(brocade_severity_num, brocade_severity_alt)
| eval brocade_code=coalesce(brocade_code, brocade_code_alt)
| eval brocade_facility=coalesce(brocade_facility, brocade_facility_alt, brocade_module, brocade_facility_simple)
| eval brocade_level_letter=if(isnull(brocade_level_letter) AND isnotnull(brocade_severity_raw), case(brocade_severity_raw=0,"M",brocade_severity_raw=1,"A",brocade_severity_raw=2,"C",brocade_severity_raw=3,"E",brocade_severity_raw=4,"W",brocade_severity_raw=5,"N",brocade_severity_raw=6,"I",brocade_severity_raw=7,"D"), brocade_level_letter)
| eval brocade_level=brocade_level_letter
| eval vendor_detected=case(isnotnull(cisco_facility), "cisco", isnotnull(brocade_facility) OR isnotnull(brocade_code) OR isnotnull(brocade_level_letter) OR isnotnull(brocade_facility_simple), "brocade", match(host, "(?i)^(SW-|RTR-|cisco|ios)"), "cisco", true(), "brocade")
| eval severity_num=case(vendor_detected="cisco" AND isnotnull(cisco_severity), tonumber(cisco_severity), vendor_detected="brocade" AND brocade_level_letter="M", 0, vendor_detected="brocade" AND brocade_level_letter="A", 1, vendor_detected="brocade" AND brocade_level_letter="C", 2, vendor_detected="brocade" AND brocade_level_letter="E", 3, vendor_detected="brocade" AND brocade_level_letter="W", 4, vendor_detected="brocade" AND brocade_level_letter="N", 5, vendor_detected="brocade" AND brocade_level_letter="I", 6, vendor_detected="brocade" AND brocade_level_letter="D", 7, isnotnull(syslog_severity), syslog_severity, true(), 6)
| eval facility_code=coalesce(cisco_facility, brocade_facility, brocade_facility_simple, brocade_code, cisco_mnemonic, "Uncategorized")
| eval mnemonic=coalesce(cisco_mnemonic, brocade_code, brocade_facility)
| eval severity_label=case(severity_num=0, "Emergency", severity_num=1, "Alert", severity_num=2, "Critical", severity_num=3, "Error", severity_num=4, "Warning", severity_num=5, "Notice", severity_num=6, "Informational", severity_num=7, "Debug", true(), "Unknown")
| search $vendor_filter$ $severity_filter$ $facility_filter$ $area_filter$ $site_filter$</query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
  </search>

  <row>
    <panel>
      <html>
        <style>
          .dashboard-body { background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%) !important; }
          .dashboard-panel { background: rgba(26, 26, 46, 0.8) !important; border: 1px solid rgba(99, 102, 241, 0.3) !important; border-radius: 16px !important; }
          .panel-title { font-family: 'Inter', 'Segoe UI', sans-serif !important; font-weight: 600 !important; font-size: 14px !important; color: #e2e8f0 !important; }
          .single-value { font-family: 'JetBrains Mono', 'Fira Code', monospace !important; }
          .single-value .single-result { font-size: 48px !important; font-weight: 700 !important; }
          .highcharts-background { fill: transparent !important; }
          .table-chrome { background: transparent !important; }
          .shared-tableview .table th { background: rgba(15, 23, 42, 0.95) !important; color: #a5b4fc !important; }
          .shared-tableview .table td { background: transparent !important; color: #e2e8f0 !important; }
          .hero-banner { padding: 20px 24px; background: linear-gradient(120deg, rgba(99,102,241,0.15), rgba(14,165,233,0.12));
                          border: 1px solid rgba(99, 102, 241, 0.35); border-radius: 18px; box-shadow: 0 15px 40px rgba(0,0,0,0.35);
                          backdrop-filter: blur(6px); color: #e2e8f0; }
          .hero-banner h1 { margin: 0 0 6px 0; font-size: 22px; font-weight: 700; letter-spacing: -0.02em; }
          .hero-banner p { margin: 4px 0 12px 0; color: #cbd5e1; font-size: 13px; }
          .hero-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
          .hero-chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; margin-right: 8px; border-radius: 999px;
                       background: rgba(15,23,42,0.65); color: #c7d2fe; font-size: 12px; border: 1px solid rgba(99,102,241,0.4); }
          .hero-card { padding: 12px; border-radius: 14px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(226,232,240,0.08);
                       box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); font-size: 13px; color: #e2e8f0; }
        </style>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Executive Experience</title>
      <html>
        <div class="hero-banner">
          <h1>Premium Network Syslog Cockpit</h1>
          <p>Curated views for routing stability, spanning tree health, and vendor performance without altering the underlying searches.</p>
          <div style="margin-bottom:10px;">
            <span class="hero-chip">Time: $time_range.earliest$ → $time_range.latest$</span>
            <span class="hero-chip">Vendor filter: $vendor_filter$</span>
            <span class="hero-chip">Severity filter: $severity_filter$</span>
            <span class="hero-chip">Facility filter: $facility_filter$</span>
            <span class="hero-chip">Area filter: $area_filter$</span>
            <span class="hero-chip">Site filter: $site_filter$</span>
          </div>
          <div class="hero-grid">
            <div class="hero-card">Interactive KPI tiles for total syslog volume, device counts, and severity-driven action lists.</div>
            <div class="hero-card">High-contrast timelines and distribution charts optimized for dark command centers.</div>
            <div class="hero-card">Precision tables for routing adjacencies, spanning-tree changes, and live syslog streaming.</div>
            <div class="hero-card">Adaptive layout with glassmorphism accents that preserves every existing query while elevating readability.</div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- KPI ROW -->
  <row>
    <panel>
      <title>Total Events</title>
      <single>
        <search base="base_syslog">
          <query>| stats count as total_events</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#1e40af","#3b82f6"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">TOTAL SYSLOG EVENTS</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Critical/Emergency</title>
      <single>
        <search base="base_syslog">
          <query>| search severity_num=0 OR severity_num=1 | stats count as critical_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308","#ef4444"]</option>
        <option name="rangeValues">[5,20]</option>
        <option name="underLabel">IMMEDIATE ATTENTION</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Errors</title>
      <single>
        <search base="base_syslog">
          <query>| search severity_num=3 | stats count as error_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#f97316","#ef4444"]</option>
        <option name="rangeValues">[10,50]</option>
        <option name="underLabel">ERROR LEVEL</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Warnings</title>
      <single>
        <search base="base_syslog">
          <query>| search severity_num=4 | stats count as warning_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308"]</option>
        <option name="rangeValues">[50]</option>
        <option name="underLabel">WARNING LEVEL</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Active Devices</title>
      <single>
        <search base="base_syslog">
          <query>| stats dc(host) as device_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#6366f1","#8b5cf6"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">REPORTING DEVICES</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Events/Minute</title>
      <single>
        <search base="base_syslog">
          <query>| stats count as total earliest(_time) as earliest_time latest(_time) as latest_time | eval time_span_min = (latest_time - earliest_time) / 60 | eval events_per_min = if(time_span_min &gt; 0, round(total / time_span_min, 2), total) | fields events_per_min</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#14b8a6","#06b6d4"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">AVG RATE</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- TIMELINE AND VENDOR DISTRIBUTION -->
  <row>
    <panel>
      <title>Event Timeline by Severity</title>
      <chart>
        <search base="base_syslog">
          <query>| eval severity_display = severity_num . "-" . severity_label | timechart span=auto count by severity_display</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.seriesColors">[#ef4444,#f97316,#dc2626,#f87171,#eab308,#22c55e,#3b82f6,#6b7280]</option>
        <option name="height">350</option>
      </chart>
    </panel>

    <panel>
      <title>Vendor Distribution</title>
      <chart>
        <search base="base_syslog">
          <query>| stats count by vendor_detected | sort -count | rename vendor_detected as Vendor</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#00bceb,#ff6b35,#6366f1]</option>
        <option name="height">350</option>
      </chart>
    </panel>
  </row>

  <!-- CISCO PANELS -->
  <row>
    <panel>
      <title>Cisco Mnemonic Breakdown</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="cisco" mnemonic=* | stats count by mnemonic | sort -count | head 15</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#00bceb]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Cisco Facility Codes</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="cisco" cisco_facility=* | stats count by cisco_facility | sort -count | head 12</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#00bceb,#0891b2,#06b6d4,#22d3ee,#67e8f9,#a5f3fc]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Cisco Interface Events</title>
      <table>
        <search base="base_syslog">
          <query>| search vendor_detected="cisco" | rex field=_raw "(?i)(?&lt;interface&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Vlan|Loopback|Tunnel|Serial|Gi|Te|Fa|Et|Po|Vl|Lo|Tu|Se)\s*\d+(?:/\d+)*(?:\.\d+)?)" | search interface=* | stats count as Events latest(_time) as Last_Seen by host interface | eval Last_Seen=strftime(Last_Seen, "%Y-%m-%d %H:%M:%S") | sort -Events | head 20 | rename host as "Device" interface as "Interface" Events as "Event Count" Last_Seen as "Last Activity"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- BROCADE PANELS -->
  <!-- Brocade syslog format: timestamp:LEVEL:FACILITY: message -->
  <!-- Level codes: A=alert C=critical D=debugging M=emergency E=error I=informational N=notification W=warning -->
  <row>
    <panel>
      <title>Brocade Event Categories</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="brocade" (brocade_facility=* OR brocade_code=*)
| eval brocade_category=coalesce(brocade_facility, brocade_code)
| eval brocade_category=replace(brocade_category, "[^A-Za-z0-9_-]", "")
| eval brocade_category=case(match(brocade_category, "^[0-9]+$"), "Unclassified", len(brocade_category)=0, "Unclassified", true(), brocade_category)
| stats count by brocade_category | sort -count | head 15 | rename brocade_category as Category</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ff6b35]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Brocade Severity Distribution</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="brocade" brocade_level=* | eval brocade_severity_label=case(brocade_level="M","Emergency",brocade_level="A","Alert",brocade_level="C","Critical",brocade_level="E","Error",brocade_level="W","Warning",brocade_level="N","Notice",brocade_level="I","Informational",brocade_level="D","Debug",true(),"Unknown") | stats count by brocade_severity_label | sort -count</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ff6b35,#fb923c,#fdba74,#fed7aa,#ea580c,#c2410c]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Brocade Interface Events</title>
      <table>
        <search base="base_syslog">
          <query>| search vendor_detected="brocade" | rex field=_raw "(?i)(?:interface|port|eth(?:ernet)?|\bet-?port)\s*(?&lt;brocade_interface&gt;\d+/\d+(?:/\d+)?|\d+-\d+-\d+)" | search brocade_interface=* | stats count as Occurrences latest(_time) as Last_Seen by host brocade_interface | eval Last_Seen=strftime(Last_Seen, "%Y-%m-%d %H:%M:%S") | sort -Occurrences | head 15 | rename host as "Device" brocade_interface as "Interface" Occurrences as "Event Count" Last_Seen as "Last Detected"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- AUTHENTICATION PANELS -->
  <row>
    <panel>
      <title>Authentication Timeline</title>
      <chart>
        <search base="base_syslog">
          <query>| rex field=_raw "(?i)(?&lt;auth_action&gt;LOGIN_SUCCESS|LOGIN_FAILED|SEC_LOGIN|login|logout|authentication|authorized|unauthorized|denied|accepted|rejected|failed|success)" | search auth_action=* | eval auth_result=case(match(auth_action, "(?i)LOGIN_SUCCESS|success|accepted|authorized|login"), "Success", match(auth_action, "(?i)LOGIN_FAILED|SEC_LOGIN|failed|denied|rejected|unauthorized"), "Failed", match(auth_action, "(?i)logout"), "Logout", true(), "Other") | timechart span=auto count by auth_result</query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#22c55e,#ef4444,#3b82f6,#6b7280]</option>
        <option name="height">300</option>
      </chart>
    </panel>

    <panel>
      <title>Failed Login Attempts</title>
      <table>
        <search base="base_syslog">
          <query>| search ("login failed" OR "failed login" OR "rejected, 1 attempt")
| rex field=_raw "(?i)SSH access by user\s+(?&lt;brocade_user&gt;[A-Za-z0-9_.-]+)\s+from\s+(?:src\s+)?IP\s+(?&lt;brocade_ip&gt;\d{1,3}(?:\.\d{1,3}){3})"
| rex field=_raw "(?i)user\s+(?&lt;brocade_user_alt&gt;[A-Za-z0-9_.-]+)\s+from\s+(?:src\s+)?IP\s+(?&lt;brocade_ip_alt&gt;\d{1,3}(?:\.\d{1,3}){3})\s+rejected"
| rex field=_raw "(?i)%SEC_LOGIN-4-LOGIN_FAILED:\s*login failed\s*\[user:\s*(?&lt;cisco_user&gt;[^\]]*)\]\s*\[source:\s*(?&lt;cisco_ip&gt;\d{1,3}(?:\.\d{1,3}){3})?\]"
| rex field=_raw "(?i)login failed\s*\[user:\s*(?&lt;cisco_user_alt&gt;[^\]]*)\]\s*\[source:\s*(?&lt;cisco_ip_alt&gt;\d{1,3}(?:\.\d{1,3}){3})?\]"
| rex field=_raw "(?i)(?:from|src|source(?: address)?|peer|addr|rhost|client)[:=\s\[\(>]+(?&lt;source_ip_generic&gt;\d{1,3}(?:\.\d{1,3}){3})"
| rex field=_raw "(?i)(?:user(?:name)?|account|login|by)[\s:=\"']+(?&lt;username_generic&gt;[A-Za-z0-9_.-]{1,64})"
| rex field=_raw "(?i)for\s+(?:user\s+)?(?&lt;username_alt&gt;[A-Za-z0-9_.-]{1,64})"
| eval brocade_ip=coalesce(brocade_ip, brocade_ip_alt)
| eval brocade_user=coalesce(brocade_user, brocade_user_alt)
| eval cisco_user=if(len(trim(cisco_user))=0, null(), cisco_user)
| eval cisco_user_alt=if(len(trim(cisco_user_alt))=0, null(), cisco_user_alt)
| eval source_ip=coalesce(brocade_ip, cisco_ip, cisco_ip_alt, source_ip_generic)
| eval username=coalesce(brocade_user, cisco_user, cisco_user_alt, username_generic, username_alt)
| eval source_ip=if(len(trim(source_ip))=0, null(), source_ip)
| eval username=if(len(trim(username))=0, null(), username)
| eval source_ip=coalesce(source_ip, "Unknown")
| eval username=coalesce(username, "Unknown")
| stats count as Attempts latest(_time) as Last_Attempt by host source_ip username
| eval Last_Attempt=strftime(Last_Attempt, "%Y-%m-%d %H:%M:%S")
| eval Threat_Level=case(Attempts&gt;=20, "HIGH", Attempts&gt;=10, "MEDIUM", Attempts&gt;=5, "LOW", true(), "INFO")
| sort -Attempts
| head 15
| rename host as "Target Device" source_ip as "Source IP" Attempts as "Failed Attempts" username as "Attempted User" Last_Attempt as "Last Seen" Threat_Level as "Risk"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- CONFIGURATION CHANGES -->
  <row>
    <panel>
      <title>Configuration Changes</title>
      <table>
        <search base="base_syslog">
          <query>| search (CONFIG* OR "configuration" OR "Configured from" OR "commit" OR "save" OR "write mem" OR "startup-config was changed") | rex field=_raw "(?i)(?:by|user)[:\s]+(?&lt;config_user&gt;[a-zA-Z0-9_\-\.]+)" | rex field=_raw "(?i)(?:from|on|via)\s+(?:vty\d+\s+)?(?&lt;config_source&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|console)" | eval config_user=coalesce(config_user, "Unknown") | eval config_source=coalesce(config_source, "Console/Local") | table _time host config_user config_source _raw | sort -_time | head 25 | eval _time=strftime(_time, "%Y-%m-%d %H:%M:%S") | rename _time as "Timestamp" host as "Device" config_user as "User" config_source as "Source" _raw as "Event Details"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- DEVICE HEALTH -->
  <row>
    <panel>
      <title>Top 15 Event Generators</title>
      <chart>
        <search base="base_syslog">
          <query>| stats count by host | sort -count | head 15</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#8b5cf6]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Device Health Matrix</title>
      <table>
        <search base="base_syslog">
          <query>| stats count as Total_Events sum(eval(if(severity_num&lt;=2,1,0))) as Critical sum(eval(if(severity_num=3,1,0))) as Errors sum(eval(if(severity_num=4,1,0))) as Warnings max(_time) as Last_Activity by host | eval Health_Score = if(Total_Events=0, 100, round(100 - ((Critical*10 + Errors*3 + Warnings) / Total_Events * 10), 0)) | eval Health_Score = if(Health_Score &lt; 0, 0, Health_Score) | eval Health_Status = case(Health_Score &gt;= 90, "Healthy", Health_Score &gt;= 70, "Warning", Health_Score &gt;= 40, "Degraded", true(), "Critical") | eval Last_Activity = strftime(Last_Activity, "%Y-%m-%d %H:%M:%S") | table host Health_Status Health_Score Total_Events Critical Errors Warnings Last_Activity | sort -Total_Events | rename host as "Device" Health_Status as "Status" Health_Score as "Score" Total_Events as "Events" Last_Activity as "Last Seen"</query>
        </search>
        <option name="count">15</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- INTERFACE LINK STATE -->
  <row>
    <panel>
      <title>Interface Link State Changes</title>
      <chart>
        <search base="base_syslog">
          <query>| rex field=_raw "(?i)(?&lt;link_state&gt;changed state to up|changed state to down|state up|state down|link.?up|link.?down|is up|is down)" | search link_state=* | eval state=if(match(link_state, "(?i)up"), "Up", "Down") | timechart span=auto count by state</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ef4444,#22c55e]</option>
        <option name="height">300</option>
      </chart>
    </panel>

    <panel>
      <title>Recent Link Down Events</title>
      <table>
        <search base="base_syslog">
          <query>| search ("changed state to down" OR "link-down" OR "is down" OR "state down") | rex field=_raw "(?i)(?&lt;interface&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Vlan|Gi|Te|Fa|Et|Po|Vl)\s*\d+(?:/\d+)*(?:\.\d+)?)" | search interface=* | stats count as Occurrences latest(_time) as Last_Down by host interface | eval Last_Down=strftime(Last_Down, "%Y-%m-%d %H:%M:%S") | eval Flapping=if(Occurrences&gt;3, "Yes", "No") | sort -Occurrences | head 20 | rename host as "Device" interface as "Interface" Occurrences as "Down Count" Last_Down as "Last Down" Flapping as "Flapping?"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- PROTOCOL DISTRIBUTION AND SPANNING TREE -->
  <row>
    <panel>
      <title>Protocol/Service Distribution</title>
      <chart>
        <search base="base_syslog">
          <query>| search facility_code=* | stats count by facility_code | sort -count | head 12</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#6366f1,#8b5cf6,#a855f7,#d946ef,#ec4899,#f43f5e]</option>
        <option name="height">350</option>
      </chart>
    </panel>

    <panel>
      <title>Spanning Tree Events</title>
      <table>
        <search base="base_syslog">
          <query>| search (SPANTREE OR STP OR MSTP OR "spanning" OR "topology" OR "root" OR "blocking" OR "forwarding" OR "Bridge TC") | rex field=_raw "(?i)VLAN\s*(?&lt;vlan_id&gt;\d+)" | rex field=_raw "(?i)(?:Port|port)\s+(?&lt;stp_port&gt;[A-Za-z0-9/]+)" | rex field=_raw "(?i)(?&lt;stp_state&gt;forwarding|blocking|listening|learning|disabled)" | eval vlan_id=coalesce(vlan_id, "N/A") | eval stp_port=coalesce(stp_port, "N/A") | eval stp_state=coalesce(stp_state, "N/A") | stats count as Events latest(_time) as Last_Event by host facility_code vlan_id stp_port stp_state | eval Last_Event=strftime(Last_Event, "%Y-%m-%d %H:%M:%S") | sort -Events | head 15 | rename host as "Device" facility_code as "Event Type" vlan_id as "VLAN" stp_port as "Port" stp_state as "State" Events as "Count" Last_Event as "Last Seen"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ROUTING PROTOCOL EVENTS -->
  <row>
    <panel>
      <title>Routing Protocol Events</title>
      <table>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| rex field=_raw "(?i)(?:Nbr|Neighbor|Peer)\s+(?:(?&lt;neighbor_ip&gt;\d{1,3}(?:\.\d{1,3}){3})|(?&lt;neighbor_name&gt;[A-Za-z0-9_.:-]+))(?:\s*\((?&lt;neighbor_int_paren&gt;[A-Za-z0-9_./-]+)\))?"
| rex field=_raw "(?i)\((?&lt;routing_int_paren&gt;[A-Za-z]{1,12}[A-Za-z0-9]*\s*\d+(?:/\d+)*(?:\.\d+)?[A-Za-z0-9/.-]*?)\)\s+(?:is\s+)?(?:Up|Down|Full|Established|Idle|Attempt|Init|Two-Way|Active|Connect)"
| rex field=_raw "(?i)(?:on|Interface)\s+(?:interface\s+)?(?&lt;routing_int&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?i)intf(?:ace)?\s+(?&lt;routing_int_alt&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?i)from\s+(?&lt;routing_state_from&gt;[A-Za-z0-9/]+)\s+to\s+(?&lt;routing_state_to&gt;[A-Za-z0-9/]+)"
| rex field=_raw "(?i)(?:state|status|to|went|goes)\s+(?&lt;routing_state&gt;Up|Down|Full|Established|Idle|Attempt|Init|Two-Way|Active|Connect|Hold|ExStart|Exchange|Loading)"
| eval neighbor_ip=coalesce(neighbor_ip, neighbor_name, "Unknown")
| eval routing_int=coalesce(routing_int, routing_int_alt, routing_int_paren, neighbor_int_paren, "Unknown")
| eval routing_int=trim(replace(routing_int, "\\s+", ""))
| eval routing_state=coalesce(routing_state_to, routing_state, routing_state_from, "Unknown")
| stats count as Events latest(routing_state) as Last_State latest(_time) as Last_Seen by routing_protocol host neighbor_ip routing_int
| eval Last_Seen=strftime(Last_Seen, "%Y-%m-%d %H:%M:%S")
| sort -Events
| head 25
| rename routing_protocol as "Protocol" host as "Device" neighbor_ip as "Neighbor" routing_int as "Interface" routing_state as "Current State" Events as "Event Count" Last_Seen as "Last Activity"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>

    <panel>
      <title>Routing Protocol State Changes</title>
      <chart>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| eval routing_state=case(match(_raw,"(?i)(down|idle|closed|hold)"),"Down", match(_raw,"(?i)(up|full|established)"),"Up", true(),"Other")
| timechart span=auto count by routing_protocol useother=f limit=0
| fields - OTHER</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#10b981,#6366f1,#8b5cf6,#f97316,#ef4444]</option>
        <option name="height">300</option>
      </chart>
    </panel>
  </row>

  <!-- ROUTING LOOP DETECTION -->
  <row>
    <panel>
      <html>
        <div style="padding: 12px; background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 12px; margin-bottom: 10px;">
          <h2 style="margin: 0 0 6px 0; color: #fca5a5; font-size: 16px; font-weight: 600;">⚠️ Routing Loop Detection</h2>
          <p style="margin: 0; color: #fecaca; font-size: 13px;">Monitors routing protocol instability, adjacency flapping, and error patterns that indicate potential routing loops</p>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Routing Loop Risk Score</title>
      <single>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| rex field=_raw "(?i)(?:Nbr|Neighbor|Peer)\s+(?:(?&lt;neighbor_ip&gt;\d{1,3}(?:\.\d{1,3}){3})|(?&lt;neighbor_name&gt;[A-Za-z0-9_.:-]+))"
| rex field=_raw "(?i)(?:on|Interface)\s+(?:interface\s+)?(?&lt;routing_int&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?i)from\s+(?&lt;routing_state_from&gt;[A-Za-z0-9/]+)\s+to\s+(?&lt;routing_state_to&gt;[A-Za-z0-9/]+)"
| rex field=_raw "(?i)(?:state|status|to|went|goes)\s+(?&lt;routing_state&gt;Up|Down|Full|Established|Idle|Attempt|Init|Two-Way|Active|Connect|Hold|ExStart|Exchange|Loading)"
| eval neighbor_ip=coalesce(neighbor_ip, neighbor_name, "Unknown")
| eval routing_int=coalesce(routing_int, "Unknown")
| eval routing_state=coalesce(routing_state_to, routing_state, routing_state_from, "Unknown")
| eval state_down=if(match(routing_state,"(?i)(down|idle|closed|hold)"),1,0)
| streamstats window=10 count as state_changes by host neighbor_ip routing_int
| where state_changes &gt; 3
| stats count as high_risk_flaps dc(host) as affected_devices
| eval loop_risk_score=round(min(100, (high_risk_flaps * 5) + (affected_devices * 10)), 0)
| eval loop_risk_score=if(isnull(loop_risk_score), 0, loop_risk_score)
| fields loop_risk_score</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308","#f97316","#ef4444"]</option>
        <option name="rangeValues">[20,40,60]</option>
        <option name="underLabel">LOOP RISK SCORE (0-100)</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Routing Adjacency Flaps</title>
      <single>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| rex field=_raw "(?i)(?:Nbr|Neighbor|Peer)\s+(?:(?&lt;neighbor_ip&gt;\d{1,3}(?:\.\d{1,3}){3})|(?&lt;neighbor_name&gt;[A-Za-z0-9_.:-]+))"
| rex field=_raw "(?i)(?:on|Interface)\s+(?:interface\s+)?(?&lt;routing_int&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| eval neighbor_ip=coalesce(neighbor_ip, neighbor_name, "Unknown")
| eval routing_int=coalesce(routing_int, "Unknown")
| streamstats window=10 count as state_changes by host neighbor_ip routing_int
| where state_changes &gt; 3
| stats dc(host) as flapping_neighbors
| eval flapping_neighbors=if(isnull(flapping_neighbors), 0, flapping_neighbors)
| fields flapping_neighbors</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308","#ef4444"]</option>
        <option name="rangeValues">[1,5]</option>
        <option name="underLabel">FLAPPING ADJACENCIES</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Loop Error Detections</title>
      <single>
        <search base="base_syslog">
          <query>| search ("routing loop" OR "loop detected" OR "max hops" OR "hop limit" OR "TTL exceeded" OR "redistribution loop" OR "route loop" OR "SIA" OR "stuck-in-active" OR "path vector loop" OR "martian" OR "metric limit")
| stats count as loop_errors
| eval loop_errors=if(isnull(loop_errors), 0, loop_errors)
| fields loop_errors</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#f97316","#ef4444"]</option>
        <option name="rangeValues">[1,10]</option>
        <option name="underLabel">EXPLICIT LOOP ERRORS</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Routing Event Velocity</title>
      <single>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| stats count as total_routing_events earliest(_time) as earliest_time latest(_time) as latest_time
| eval time_span_min = (latest_time - earliest_time) / 60
| eval events_per_min = if(time_span_min &gt; 0, round(total_routing_events / time_span_min, 2), total_routing_events)
| eval events_per_min=if(isnull(events_per_min), 0, events_per_min)
| fields events_per_min</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308","#f97316","#ef4444"]</option>
        <option name="rangeValues">[5,10,20]</option>
        <option name="underLabel">ROUTING EVENTS/MIN</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Routing Adjacency Flapping Detection (Potential Loop Indicators)</title>
      <table>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| rex field=_raw "(?i)(?:Nbr|Neighbor|Peer)\s+(?:(?&lt;neighbor_ip&gt;\d{1,3}(?:\.\d{1,3}){3})|(?&lt;neighbor_name&gt;[A-Za-z0-9_.:-]+))(?:\s*\((?&lt;neighbor_int_paren&gt;[A-Za-z0-9_./-]+)\))?"
| rex field=_raw "(?i)\((?&lt;routing_int_paren&gt;[A-Za-z]{1,12}[A-Za-z0-9]*\s*\d+(?:/\d+)*(?:\.\d+)?[A-Za-z0-9/.-]*?)\)\s+(?:is\s+)?(?:Up|Down|Full|Established|Idle|Attempt|Init|Two-Way|Active|Connect)"
| rex field=_raw "(?i)(?:on|Interface)\s+(?:interface\s+)?(?&lt;routing_int&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?i)intf(?:ace)?\s+(?&lt;routing_int_alt&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?i)from\s+(?&lt;routing_state_from&gt;[A-Za-z0-9/]+)\s+to\s+(?&lt;routing_state_to&gt;[A-Za-z0-9/]+)"
| rex field=_raw "(?i)(?:state|status|to|went|goes)\s+(?&lt;routing_state&gt;Up|Down|Full|Established|Idle|Attempt|Init|Two-Way|Active|Connect|Hold|ExStart|Exchange|Loading)"
| eval neighbor_ip=coalesce(neighbor_ip, neighbor_name, "Unknown")
| eval routing_int=coalesce(routing_int, routing_int_alt, routing_int_paren, neighbor_int_paren, "Unknown")
| eval routing_int=trim(replace(routing_int, "\\s+", ""))
| eval routing_state=coalesce(routing_state_to, routing_state, routing_state_from, "Unknown")
| eval state_down=if(match(routing_state,"(?i)(down|idle|closed|hold)"),1,0)
| sort 0 _time
| streamstats window=20 count as state_changes sum(state_down) as down_events by host neighbor_ip routing_int
| where state_changes &gt; 5
| stats count as Flap_Count min(_time) as First_Flap max(_time) as Last_Flap sum(state_down) as Down_Events dc(routing_state) as Unique_States by routing_protocol host neighbor_ip routing_int
| eval Flap_Duration_Min=round((Last_Flap - First_Flap) / 60, 1)
| eval Flap_Rate=if(Flap_Duration_Min&gt;0, round(Flap_Count/Flap_Duration_Min, 2), Flap_Count)
| eval Loop_Risk=case(Flap_Count&gt;=20 AND Flap_Rate&gt;=2, "CRITICAL", Flap_Count&gt;=10 AND Flap_Rate&gt;=1, "HIGH", Flap_Count&gt;=5, "MEDIUM", true(), "LOW")
| eval First_Flap=strftime(First_Flap, "%Y-%m-%d %H:%M:%S")
| eval Last_Flap=strftime(Last_Flap, "%Y-%m-%d %H:%M:%S")
| sort -Loop_Risk -Flap_Count
| head 25
| rename routing_protocol as "Protocol" host as "Device" neighbor_ip as "Neighbor" routing_int as "Interface" Flap_Count as "Flaps" Flap_Duration_Min as "Duration (min)" Flap_Rate as "Flaps/Min" Down_Events as "Down Count" Unique_States as "State Changes" Loop_Risk as "Risk Level" First_Flap as "First Detected" Last_Flap as "Last Detected"</query>
        </search>
        <option name="count">15</option>
        <option name="drilldown">none</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Routing Protocol Event Rate Timeline (Anomaly Detection)</title>
      <chart>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| timechart span=auto count by routing_protocol useother=f limit=0
| fields - OTHER</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.seriesColors">[#10b981,#6366f1,#8b5cf6,#f97316,#ef4444]</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="height">300</option>
      </chart>
    </panel>

    <panel>
      <title>Devices with Highest Routing Instability</title>
      <chart>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| rex field=_raw "(?i)(?:state|status|to|went|goes)\s+(?&lt;routing_state&gt;Up|Down|Full|Established|Idle|Attempt|Init|Two-Way|Active|Connect|Hold|ExStart|Exchange|Loading)"
| eval state_down=if(match(routing_state,"(?i)(down|idle|closed|hold)"),1,0)
| stats count as Total_Events sum(state_down) as Down_Events by host
| eval Instability_Score=round((Down_Events / Total_Events) * 100, 1)
| sort -Instability_Score
| head 15
| rename host as "Device"
| fields Device Instability_Score</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ef4444]</option>
        <option name="charting.axisY.maximumNumber">100</option>
        <option name="height">350</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Explicit Loop Error Messages</title>
      <table>
        <search base="base_syslog">
          <query>| search ("routing loop" OR "loop detected" OR "max hops" OR "hop limit" OR "TTL exceeded" OR "redistribution loop" OR "route loop" OR "SIA" OR "stuck-in-active" OR "path vector loop" OR "martian" OR "metric limit" OR "invalid next hop" OR "recursive routing" OR "forwarding loop")
| eval Loop_Type=case(match(_raw,"(?i)redistribution loop"),"Redistribution Loop", match(_raw,"(?i)stuck.?in.?active|SIA"),"EIGRP SIA", match(_raw,"(?i)TTL exceeded"),"TTL Exceeded", match(_raw,"(?i)path vector loop"),"BGP Path Loop", match(_raw,"(?i)max.?hops|hop.?limit|metric.?limit"),"Hop/Metric Limit", match(_raw,"(?i)martian"),"Martian Address", match(_raw,"(?i)recursive routing|forwarding loop"),"Recursive/Forwarding Loop", true(),"Generic Loop Detection")
| rex field=_raw "(?i)(?:on|Interface)\s+(?:interface\s+)?(?&lt;interface&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?&lt;ip_address&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"
| eval interface=coalesce(interface, "N/A")
| eval ip_address=coalesce(ip_address, "N/A")
| table _time host Loop_Type interface ip_address severity_label _raw
| eval _time=strftime(_time, "%Y-%m-%d %H:%M:%S")
| sort -_time
| head 50
| rename _time as "Timestamp" host as "Device" Loop_Type as "Loop Type" interface as "Interface" ip_address as "IP Address" severity_label as "Severity" _raw as "Full Message"</query>
        </search>
        <option name="count">15</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Correlated Routing and Interface Instability</title>
      <table>
        <search base="base_syslog">
          <query>| eval is_routing_event=if(match(_raw, "(?i)(BGP|OSPF|EIGRP|ISIS|RIP)"), 1, 0)
| eval is_interface_event=if(match(_raw, "(?i)(changed state|link.?down|link.?up|flap)"), 1, 0)
| eval has_correlation=if(is_routing_event=1 AND is_interface_event=1, 1, 0)
| rex field=_raw "(?i)(?&lt;interface&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Bundle-Ether|Eth-Trunk|Loopback|Vlan|Vl|Gi|Te|Fa|Et|Po|Lo|Se|Hu|Fo)[A-Za-z]*\s*\d+(?:/\d+)*(?:\.\d+)?)"
| rex field=_raw "(?i)(?:Nbr|Neighbor|Peer)\s+(?:(?&lt;neighbor_ip&gt;\d{1,3}(?:\.\d{1,3}){3})|(?&lt;neighbor_name&gt;[A-Za-z0-9_.:-]+))"
| eval interface=coalesce(interface, "Unknown")
| eval neighbor=coalesce(neighbor_ip, neighbor_name, "N/A")
| where has_correlation=1
| bucket _time span=5m
| stats count as Correlated_Events dc(interface) as Affected_Interfaces values(neighbor) as Neighbors by _time host interface
| eval Neighbors=mvjoin(Neighbors, ", ")
| eval Loop_Indicator=if(Correlated_Events&gt;5, "High Risk", if(Correlated_Events&gt;2, "Medium Risk", "Low Risk"))
| eval _time=strftime(_time, "%Y-%m-%d %H:%M:%S")
| sort -Correlated_Events
| head 25
| rename _time as "Time Window" host as "Device" interface as "Interface" Correlated_Events as "Event Count" Affected_Interfaces as "Interfaces" Neighbors as "Affected Neighbors" Loop_Indicator as "Risk"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- LIVE SYSLOG STREAM -->
  <row>
    <panel>
      <title>Live Syslog Stream</title>
      <input type="text" token="search_filter" searchWhenChanged="true">
        <label>Quick Search</label>
        <default>*</default>
      </input>
      <table>
        <search base="base_syslog">
          <query>| search $search_filter$ | table _time severity_label severity_num host vendor_detected facility_code mnemonic _raw | sort -_time | head 100 | eval _time=strftime(_time, "%Y-%m-%d %H:%M:%S") | rename _time as "Timestamp" severity_label as "Severity" severity_num as "Level" host as "Device" vendor_detected as "Vendor" facility_code as "Facility" mnemonic as "Mnemonic" _raw as "Message"</query>
        </search>
        <option name="count">20</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

</form>
