<form version="1.1" theme="dark">
  <label>Network Syslog Intelligence Center</label>
  <description>Comprehensive monitoring for Cisco and Brocade network infrastructure | Real-time syslog analysis and alerting</description>

  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_range" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="vendor_filter" searchWhenChanged="true">
      <label>Vendor</label>
      <choice value="">All Vendors</choice>
      <choice value="vendor_detected=&quot;cisco&quot;">Cisco</choice>
      <choice value="vendor_detected=&quot;brocade&quot;">Brocade</choice>
      <default></default>
    </input>
    <input type="dropdown" token="severity_filter" searchWhenChanged="true">
      <label>Severity</label>
      <choice value="">All Severities</choice>
      <choice value="severity_num=0">Emergency (0)</choice>
      <choice value="severity_num=1">Alert (1)</choice>
      <choice value="severity_num=2">Critical (2)</choice>
      <choice value="severity_num=3">Error (3)</choice>
      <choice value="severity_num=4">Warning (4)</choice>
      <choice value="severity_num=5">Notice (5)</choice>
      <choice value="severity_num=6">Informational (6)</choice>
      <choice value="severity_num=7">Debug (7)</choice>
      <default></default>
    </input>
    <input type="text" token="device_filter" searchWhenChanged="true">
      <label>Device Filter</label>
      <default>*</default>
      <prefix>host=</prefix>
    </input>
    <input type="dropdown" token="facility_filter" searchWhenChanged="true">
      <label>Facility</label>
      <choice value="">All Facilities</choice>
      <choice value="facility_num=0">Kernel (0)</choice>
      <choice value="facility_num=1">User (1)</choice>
      <choice value="facility_num=4">Auth (4)</choice>
      <choice value="facility_num=10">Security (10)</choice>
      <choice value="facility_num=16">Local0 (16)</choice>
      <choice value="facility_num=17">Local1 (17)</choice>
      <choice value="facility_num=18">Local2 (18)</choice>
      <choice value="facility_num=19">Local3 (19)</choice>
      <choice value="facility_num=20">Local4 (20)</choice>
      <choice value="facility_num=21">Local5 (21)</choice>
      <choice value="facility_num=22">Local6 (22)</choice>
      <choice value="facility_num=23">Local7 (23)</choice>
      <default></default>
    </input>
  </fieldset>

  <!-- BASE SEARCH: Detects vendor and parses syslog format accordingly -->
  <!-- Cisco format: %FACILITY-SEVERITY-MNEMONIC: message -->
  <!-- Brocade format: timestamp:LEVEL_CODE:FACILITY: message (A=alert,C=critical,D=debug,M=emergency,E=error,I=info,N=notice,W=warning) -->
  <search id="base_syslog">
    <query>index=network_syslog $device_filter$
| rex field=_raw "^&lt;(?&lt;pri&gt;\d+)&gt;"
| eval pri=tonumber(pri)
| eval facility_num=if(isnum(pri), floor(pri/8), null())
| eval syslog_severity=if(isnum(pri), pri%8, null())
| rex field=_raw "%(?&lt;cisco_facility&gt;[A-Z][A-Z0-9_]*)-(?&lt;cisco_severity&gt;[0-7])-(?&lt;cisco_mnemonic&gt;[A-Z0-9_]+)"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})[:,\s]+(?&lt;brocade_level_letter&gt;[ACDMEINW])[:\s]+(?&lt;brocade_facility&gt;[A-Za-z0-9_\-]+)"
| rex field=_raw "^(?:&lt;\d+&gt;\s*)?(?:\w{3}\s+\d+\s+\d{2}:\d{2}:\d{2}|\d{4}/\d{2}/\d{2}-\d{2}:\d{2}:\d{2})\s+(?&lt;brocade_host_token&gt;[^\s:]+)\s+(?&lt;brocade_facility_simple&gt;[A-Za-z0-9_.\-]+)"
| rex field=_raw "\[(?&lt;brocade_module&gt;[A-Z0-9]{3})/(?&lt;brocade_severity_num&gt;[0-7])/(?&lt;brocade_code&gt;[A-Z0-9_-]+)\]"
| rex field=_raw "%(?&lt;brocade_facility_alt&gt;[A-Z0-9_]+)-(?&lt;brocade_severity_alt&gt;[0-7])-(?&lt;brocade_code_alt&gt;[A-Z0-9_-]+)"
| eval brocade_severity_raw=coalesce(brocade_severity_num, brocade_severity_alt)
| eval brocade_code=coalesce(brocade_code, brocade_code_alt)
| eval brocade_facility=coalesce(brocade_facility, brocade_facility_alt, brocade_module, brocade_facility_simple)
| eval brocade_level_letter=if(isnull(brocade_level_letter) AND isnotnull(brocade_severity_raw), case(brocade_severity_raw=0,"M",brocade_severity_raw=1,"A",brocade_severity_raw=2,"C",brocade_severity_raw=3,"E",brocade_severity_raw=4,"W",brocade_severity_raw=5,"N",brocade_severity_raw=6,"I",brocade_severity_raw=7,"D"), brocade_level_letter)
| eval brocade_level=brocade_level_letter
| eval vendor_detected=case(isnotnull(cisco_facility), "cisco", isnotnull(brocade_facility) OR isnotnull(brocade_code) OR isnotnull(brocade_level_letter) OR isnotnull(brocade_facility_simple), "brocade", match(host, "(?i)^(SW-|RTR-|cisco|ios)"), "cisco", true(), "brocade")
| eval severity_num=case(vendor_detected="cisco" AND isnotnull(cisco_severity), tonumber(cisco_severity), vendor_detected="brocade" AND brocade_level_letter="M", 0, vendor_detected="brocade" AND brocade_level_letter="A", 1, vendor_detected="brocade" AND brocade_level_letter="C", 2, vendor_detected="brocade" AND brocade_level_letter="E", 3, vendor_detected="brocade" AND brocade_level_letter="W", 4, vendor_detected="brocade" AND brocade_level_letter="N", 5, vendor_detected="brocade" AND brocade_level_letter="I", 6, vendor_detected="brocade" AND brocade_level_letter="D", 7, isnotnull(syslog_severity), syslog_severity, true(), 6)
| eval facility_code=coalesce(cisco_facility, brocade_facility, brocade_facility_simple, brocade_code, cisco_mnemonic, "Uncategorized")
| eval mnemonic=coalesce(cisco_mnemonic, brocade_code, brocade_facility)
| eval severity_label=case(severity_num=0, "Emergency", severity_num=1, "Alert", severity_num=2, "Critical", severity_num=3, "Error", severity_num=4, "Warning", severity_num=5, "Notice", severity_num=6, "Informational", severity_num=7, "Debug", true(), "Unknown")
| search $vendor_filter$ $severity_filter$ $facility_filter$</query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
  </search>

  <row>
    <panel>
      <html>
        <style>
          .dashboard-body { background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%) !important; }
          .dashboard-panel { background: rgba(26, 26, 46, 0.8) !important; border: 1px solid rgba(99, 102, 241, 0.3) !important; border-radius: 16px !important; }
          .panel-title { font-family: 'Inter', 'Segoe UI', sans-serif !important; font-weight: 600 !important; font-size: 14px !important; color: #e2e8f0 !important; }
          .single-value { font-family: 'JetBrains Mono', 'Fira Code', monospace !important; }
          .single-value .single-result { font-size: 48px !important; font-weight: 700 !important; }
          .highcharts-background { fill: transparent !important; }
          .table-chrome { background: transparent !important; }
          .shared-tableview .table th { background: rgba(15, 23, 42, 0.95) !important; color: #a5b4fc !important; }
          .shared-tableview .table td { background: transparent !important; color: #e2e8f0 !important; }
        </style>
      </html>
    </panel>
  </row>

  <!-- KPI ROW -->
  <row>
    <panel>
      <title>Total Events</title>
      <single>
        <search base="base_syslog">
          <query>| stats count as total_events</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#1e40af","#3b82f6"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">TOTAL SYSLOG EVENTS</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Critical/Emergency</title>
      <single>
        <search base="base_syslog">
          <query>| search severity_num=0 OR severity_num=1 | stats count as critical_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308","#ef4444"]</option>
        <option name="rangeValues">[5,20]</option>
        <option name="underLabel">IMMEDIATE ATTENTION</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Errors</title>
      <single>
        <search base="base_syslog">
          <query>| search severity_num=3 | stats count as error_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#f97316","#ef4444"]</option>
        <option name="rangeValues">[10,50]</option>
        <option name="underLabel">ERROR LEVEL</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Warnings</title>
      <single>
        <search base="base_syslog">
          <query>| search severity_num=4 | stats count as warning_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#22c55e","#eab308"]</option>
        <option name="rangeValues">[50]</option>
        <option name="underLabel">WARNING LEVEL</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Active Devices</title>
      <single>
        <search base="base_syslog">
          <query>| stats dc(host) as device_count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#6366f1","#8b5cf6"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">REPORTING DEVICES</option>
        <option name="useColors">1</option>
      </single>
    </panel>

    <panel>
      <title>Events/Minute</title>
      <single>
        <search base="base_syslog">
          <query>| stats count as total earliest(_time) as earliest_time latest(_time) as latest_time | eval time_span_min = (latest_time - earliest_time) / 60 | eval events_per_min = if(time_span_min &gt; 0, round(total / time_span_min, 2), total) | fields events_per_min</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#14b8a6","#06b6d4"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">AVG RATE</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- TIMELINE AND VENDOR DISTRIBUTION -->
  <row>
    <panel>
      <title>Event Timeline by Severity</title>
      <chart>
        <search base="base_syslog">
          <query>| eval severity_display = severity_num . "-" . severity_label | timechart span=10m count by severity_display</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.seriesColors">[#ef4444,#f97316,#dc2626,#f87171,#eab308,#22c55e,#3b82f6,#6b7280]</option>
        <option name="height">350</option>
      </chart>
    </panel>

    <panel>
      <title>Vendor Distribution</title>
      <chart>
        <search base="base_syslog">
          <query>| stats count by vendor_detected | sort -count | rename vendor_detected as Vendor</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#00bceb,#ff6b35,#6366f1]</option>
        <option name="height">350</option>
      </chart>
    </panel>
  </row>

  <!-- CISCO PANELS -->
  <row>
    <panel>
      <title>Cisco Mnemonic Breakdown</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="cisco" mnemonic=* | stats count by mnemonic | sort -count | head 15</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#00bceb]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Cisco Facility Codes</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="cisco" cisco_facility=* | stats count by cisco_facility | sort -count | head 12</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#00bceb,#0891b2,#06b6d4,#22d3ee,#67e8f9,#a5f3fc]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Cisco Interface Events</title>
      <table>
        <search base="base_syslog">
          <query>| search vendor_detected="cisco" | rex field=_raw "(?i)(?&lt;interface&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Vlan|Loopback|Tunnel|Serial|Gi|Te|Fa|Et|Po|Vl|Lo|Tu|Se)\s*\d+(?:/\d+)*(?:\.\d+)?)" | search interface=* | stats count as Events latest(_time) as Last_Seen by host interface | eval Last_Seen=strftime(Last_Seen, "%Y-%m-%d %H:%M:%S") | sort -Events | head 20 | rename host as "Device" interface as "Interface" Events as "Event Count" Last_Seen as "Last Activity"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- BROCADE PANELS -->
  <!-- Brocade syslog format: timestamp:LEVEL:FACILITY: message -->
  <!-- Level codes: A=alert C=critical D=debugging M=emergency E=error I=informational N=notification W=warning -->
  <row>
    <panel>
      <title>Brocade Event Categories</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="brocade" (brocade_facility=* OR brocade_code=*)
| eval brocade_category=coalesce(brocade_facility, brocade_code)
| eval brocade_category=replace(brocade_category, "[^A-Za-z0-9_-]", "")
| eval brocade_category=case(match(brocade_category, "^[0-9]+$"), "Unclassified", len(brocade_category)=0, "Unclassified", true(), brocade_category)
| stats count by brocade_category | sort -count | head 15 | rename brocade_category as Category</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ff6b35]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Brocade Severity Distribution</title>
      <chart>
        <search base="base_syslog">
          <query>| search vendor_detected="brocade" brocade_level=* | eval brocade_severity_label=case(brocade_level="M","Emergency",brocade_level="A","Alert",brocade_level="C","Critical",brocade_level="E","Error",brocade_level="W","Warning",brocade_level="N","Notice",brocade_level="I","Informational",brocade_level="D","Debug",true(),"Unknown") | stats count by brocade_severity_label | sort -count</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ff6b35,#fb923c,#fdba74,#fed7aa,#ea580c,#c2410c]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Brocade Interface Events</title>
      <table>
        <search base="base_syslog">
          <query>| search vendor_detected="brocade" | rex field=_raw "(?i)(?:interface|port|eth(?:ernet)?|\bet-?port)\s*(?&lt;brocade_interface&gt;\d+/\d+(?:/\d+)?|\d+-\d+-\d+)" | search brocade_interface=* | stats count as Occurrences latest(_time) as Last_Seen by host brocade_interface | eval Last_Seen=strftime(Last_Seen, "%Y-%m-%d %H:%M:%S") | sort -Occurrences | head 15 | rename host as "Device" brocade_interface as "Interface" Occurrences as "Event Count" Last_Seen as "Last Detected"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- AUTHENTICATION PANELS -->
  <row>
    <panel>
      <title>Authentication Timeline</title>
      <chart>
        <search base="base_syslog">
          <query>| rex field=_raw "(?i)(?&lt;auth_action&gt;LOGIN_SUCCESS|LOGIN_FAILED|SEC_LOGIN|login|logout|authentication|authorized|unauthorized|denied|accepted|rejected|failed|success)" | search auth_action=* | eval auth_result=case(match(auth_action, "(?i)LOGIN_SUCCESS|success|accepted|authorized|login"), "Success", match(auth_action, "(?i)LOGIN_FAILED|SEC_LOGIN|failed|denied|rejected|unauthorized"), "Failed", match(auth_action, "(?i)logout"), "Logout", true(), "Other") | timechart span=30m count by auth_result</query>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#22c55e,#ef4444,#3b82f6,#6b7280]</option>
        <option name="height">300</option>
      </chart>
    </panel>

    <panel>
      <title>Failed Login Attempts</title>
      <table>
        <search base="base_syslog">
          <query>| search ("login failed" OR "failed login" OR "authentication failure" OR "failed password" OR "LOGIN_FAILED" OR "AAA-3-USER_LOGIN_FAILED" OR "SEC_LOGIN" OR "invalid user" OR "SSH access" OR "rejected, 1 attempt")
| rex field=_raw "(?i)SSH access by user\s+(?&lt;brocade_user&gt;[A-Za-z0-9_.-]+)\s+from\s+(?:src\s+)?IP\s+(?&lt;brocade_ip&gt;\d{1,3}(?:\.\d{1,3}){3})"
| rex field=_raw "(?i)login failed\s*\[user:\s*(?&lt;cisco_user&gt;[^\]\s]*)\]\s*\[source:\s*(?&lt;cisco_ip&gt;\d{1,3}(?:\.\d{1,3}){3})\]"
| rex field=_raw "(?i)%SEC_LOGIN-4-LOGIN_FAILED:\s*login failed\s*\[user:\s*(?&lt;cisco_user_alt&gt;[^\]\s]*)\]\s*\[source:\s*(?&lt;cisco_ip_alt&gt;\d{1,3}(?:\.\d{1,3}){3})?\]"
| rex field=_raw "(?i)(?:from|src|source(?: address)?|peer|addr|rhost|client)[:=\s\[\(>]+(?&lt;source_ip&gt;\d{1,3}(?:\.\d{1,3}){3})"
| rex field=_raw "(?i)(?:user(?:name)?|account|login|by)[\s:=\"']+(?&lt;username&gt;[A-Za-z0-9_.-]{1,64})"
| rex field=_raw "(?i)for\s+(?:user\s+)?(?&lt;username_alt&gt;[A-Za-z0-9_.-]{1,64})"
| rex field=_raw "(?i)user\s+(?&lt;username_brocade&gt;[A-Za-z0-9_.-]+)\s+from\s+(?:src\s+)?IP"
| eval source_ip=coalesce(brocade_ip, cisco_ip, cisco_ip_alt, source_ip)
| eval username=coalesce(brocade_user, cisco_user, cisco_user_alt, username, username_alt, username_brocade)
| eval source_ip=if(len(trim(source_ip))=0, null(), source_ip)
| eval username=if(len(trim(username))=0, null(), username)
| eval source_ip=coalesce(source_ip, "Unknown")
| eval username=coalesce(username, "Unknown")
| stats count as Attempts latest(_time) as Last_Attempt by host source_ip username
| eval Last_Attempt=strftime(Last_Attempt, "%Y-%m-%d %H:%M:%S")
| eval Threat_Level=case(Attempts&gt;=20, "HIGH", Attempts&gt;=10, "MEDIUM", Attempts&gt;=5, "LOW", true(), "INFO")
| sort -Attempts
| head 15
| rename host as "Target Device" source_ip as "Source IP" Attempts as "Failed Attempts" username as "Attempted User" Last_Attempt as "Last Seen" Threat_Level as "Risk"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- CONFIGURATION CHANGES -->
  <row>
    <panel>
      <title>Configuration Changes</title>
      <table>
        <search base="base_syslog">
          <query>| search (CONFIG* OR "configuration" OR "Configured from" OR "commit" OR "save" OR "write mem" OR "startup-config was changed") | rex field=_raw "(?i)(?:by|user)[:\s]+(?&lt;config_user&gt;[a-zA-Z0-9_\-\.]+)" | rex field=_raw "(?i)(?:from|on|via)\s+(?:vty\d+\s+)?(?&lt;config_source&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|console)" | eval config_user=coalesce(config_user, "Unknown") | eval config_source=coalesce(config_source, "Console/Local") | table _time host config_user config_source _raw | sort -_time | head 25 | eval _time=strftime(_time, "%Y-%m-%d %H:%M:%S") | rename _time as "Timestamp" host as "Device" config_user as "User" config_source as "Source" _raw as "Event Details"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <!-- DEVICE HEALTH -->
  <row>
    <panel>
      <title>Top 15 Event Generators</title>
      <chart>
        <search base="base_syslog">
          <query>| stats count by host | sort -count | head 15</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#8b5cf6]</option>
        <option name="height">400</option>
      </chart>
    </panel>

    <panel>
      <title>Device Health Matrix</title>
      <table>
        <search base="base_syslog">
          <query>| stats count as Total_Events sum(eval(if(severity_num&lt;=2,1,0))) as Critical sum(eval(if(severity_num=3,1,0))) as Errors sum(eval(if(severity_num=4,1,0))) as Warnings max(_time) as Last_Activity by host | eval Health_Score = if(Total_Events=0, 100, round(100 - ((Critical*10 + Errors*3 + Warnings) / Total_Events * 10), 0)) | eval Health_Score = if(Health_Score &lt; 0, 0, Health_Score) | eval Health_Status = case(Health_Score &gt;= 90, "Healthy", Health_Score &gt;= 70, "Warning", Health_Score &gt;= 40, "Degraded", true(), "Critical") | eval Last_Activity = strftime(Last_Activity, "%Y-%m-%d %H:%M:%S") | table host Health_Status Health_Score Total_Events Critical Errors Warnings Last_Activity | sort -Total_Events | rename host as "Device" Health_Status as "Status" Health_Score as "Score" Total_Events as "Events" Last_Activity as "Last Seen"</query>
        </search>
        <option name="count">15</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- INTERFACE LINK STATE -->
  <row>
    <panel>
      <title>Interface Link State Changes</title>
      <chart>
        <search base="base_syslog">
          <query>| rex field=_raw "(?i)(?&lt;link_state&gt;changed state to up|changed state to down|state up|state down|link.?up|link.?down|is up|is down)" | search link_state=* | eval state=if(match(link_state, "(?i)up"), "Up", "Down") | timechart span=15m count by state</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#ef4444,#22c55e]</option>
        <option name="height">300</option>
      </chart>
    </panel>

    <panel>
      <title>Recent Link Down Events</title>
      <table>
        <search base="base_syslog">
          <query>| search ("changed state to down" OR "link-down" OR "is down" OR "state down") | rex field=_raw "(?i)(?&lt;interface&gt;(?:GigabitEthernet|TenGigabitEthernet|FastEthernet|Ethernet|Port-?channel|Vlan|Gi|Te|Fa|Et|Po|Vl)\s*\d+(?:/\d+)*(?:\.\d+)?)" | search interface=* | stats count as Occurrences latest(_time) as Last_Down by host interface | eval Last_Down=strftime(Last_Down, "%Y-%m-%d %H:%M:%S") | eval Flapping=if(Occurrences&gt;3, "Yes", "No") | sort -Occurrences | head 20 | rename host as "Device" interface as "Interface" Occurrences as "Down Count" Last_Down as "Last Down" Flapping as "Flapping?"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- PROTOCOL DISTRIBUTION AND SPANNING TREE -->
  <row>
    <panel>
      <title>Protocol/Service Distribution</title>
      <chart>
        <search base="base_syslog">
          <query>| search facility_code=* | stats count by facility_code | sort -count | head 12</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">1</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#6366f1,#8b5cf6,#a855f7,#d946ef,#ec4899,#f43f5e]</option>
        <option name="height">350</option>
      </chart>
    </panel>

    <panel>
      <title>Spanning Tree Events</title>
      <table>
        <search base="base_syslog">
          <query>| search (SPANTREE OR STP OR MSTP OR "spanning" OR "topology" OR "root" OR "blocking" OR "forwarding" OR "Bridge TC") | rex field=_raw "(?i)VLAN\s*(?&lt;vlan_id&gt;\d+)" | rex field=_raw "(?i)(?:Port|port)\s+(?&lt;stp_port&gt;[A-Za-z0-9/]+)" | rex field=_raw "(?i)(?&lt;stp_state&gt;forwarding|blocking|listening|learning|disabled)" | eval vlan_id=coalesce(vlan_id, "N/A") | eval stp_port=coalesce(stp_port, "N/A") | eval stp_state=coalesce(stp_state, "N/A") | stats count as Events latest(_time) as Last_Event by host facility_code vlan_id stp_port stp_state | eval Last_Event=strftime(Last_Event, "%Y-%m-%d %H:%M:%S") | sort -Events | head 15 | rename host as "Device" facility_code as "Event Type" vlan_id as "VLAN" stp_port as "Port" stp_state as "State" Events as "Count" Last_Event as "Last Seen"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ROUTING PROTOCOL EVENTS -->
  <row>
    <panel>
      <title>Routing Protocol Events</title>
      <table>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| rex field=_raw "(?i)(?:Nbr|Neighbor|Peer)\s+(?&lt;neighbor_ip&gt;\d{1,3}(?:\.\d{1,3}){3})"
| rex field=_raw "(?i)on\s+(?&lt;routing_int&gt;[A-Za-z0-9/\.]+)"
| rex field=_raw "(?i)to\s+(?&lt;routing_state&gt;[A-Z0-9_]+)"
| eval neighbor_ip=coalesce(neighbor_ip,"Unknown")
| eval routing_int=coalesce(routing_int,"Unknown")
| eval routing_state=coalesce(routing_state,"Unknown")
| stats count as Events latest(routing_state) as Last_State latest(_time) as Last_Seen by routing_protocol host neighbor_ip routing_int
| eval Last_Seen=strftime(Last_Seen, "%Y-%m-%d %H:%M:%S")
| sort -Events
| head 25
| rename routing_protocol as "Protocol" host as "Device" neighbor_ip as "Neighbor" routing_int as "Interface" routing_state as "Current State" Events as "Event Count" Last_Seen as "Last Activity"</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>

    <panel>
      <title>Routing Protocol State Changes</title>
      <chart>
        <search base="base_syslog">
          <query>| eval routing_protocol=case(match(_raw,"(?i)BGP"),"BGP", match(_raw,"(?i)OSPF"),"OSPF", match(_raw,"(?i)EIGRP"),"EIGRP", match(_raw,"(?i)ISIS|IS-IS"),"IS-IS", match(_raw,"(?i)RIP"),"RIP", true(), null())
| search routing_protocol=*
| eval routing_state=case(match(_raw,"(?i)(down|idle|closed|hold)"),"Down", match(_raw,"(?i)(up|full|established)"),"Up", true(),"Other")
| timechart span=1h count by routing_protocol useother=f limit=0
| fields - OTHER</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.seriesColors">[#10b981,#6366f1,#8b5cf6,#f97316,#ef4444]</option>
        <option name="height">300</option>
      </chart>
    </panel>
  </row>

  <!-- LIVE SYSLOG STREAM -->
  <row>
    <panel>
      <title>Live Syslog Stream</title>
      <input type="text" token="search_filter" searchWhenChanged="true">
        <label>Quick Search</label>
        <default>*</default>
      </input>
      <table>
        <search base="base_syslog">
          <query>| search $search_filter$ | table _time severity_label severity_num host vendor_detected facility_code mnemonic _raw | sort -_time | head 100 | eval _time=strftime(_time, "%Y-%m-%d %H:%M:%S") | rename _time as "Timestamp" severity_label as "Severity" severity_num as "Level" host as "Device" vendor_detected as "Vendor" facility_code as "Facility" mnemonic as "Mnemonic" _raw as "Message"</query>
        </search>
        <option name="count">20</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>

</form>
